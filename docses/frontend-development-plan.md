# 前端开发计划

## 🎯 项目概述

RAG-Anything前端基于现有的LightRAG WebUI进行适配改造，实现完整的多模态RAG系统用户界面。

### 技术栈
- **框架**: React 19 + TypeScript
- **构建工具**: Vite 6.1.1
- **样式**: Tailwind CSS 4.0.8 + Radix UI
- **状态管理**: Zustand
- **图表可视化**: Sigma.js + React-Sigma
- **国际化**: React-i18next

## 📋 详细开发任务

### Phase 1: API适配与基础集成 (🔥高优先级)

#### 1.1 API接口层适配
**预估时间**: 2天
**负责模块**: `src/api/lightrag.ts`

**具体任务**:
```typescript
// 需要修改的接口适配
1. 更新 backendBaseUrl 配置
   - 当前: http://localhost:8000 (LightRAG)
   - 修改为: http://localhost:8001 (RAG-Anything web-api)

2. 适配响应数据格式
   - 文档状态接口: /documents
   - 查询接口: /query  
   - 健康检查接口: /health
   - 知识图谱接口: /graph

3. 更新类型定义
   - DocStatusResponse: 适配RAG-Anything的文档状态格式
   - QueryResponse: 适配查询结果格式
   - LightragStatus: 适配系统状态格式
```

**验收标准**:
- [ ] API调用成功率100%
- [ ] 数据类型匹配，无TypeScript错误
- [ ] 错误处理机制完善

#### 1.2 环境配置优化
**预估时间**: 1天
**负责模块**: 根目录配置文件

**具体任务**:
```bash
# 1. 创建正确的环境配置
echo "VITE_BACKEND_URL=http://localhost:8001" > .env.development
echo "VITE_BACKEND_URL=http://localhost:8001" > .env.production

# 2. 修复依赖兼容性
npm audit fix
npm update

# 3. 验证构建配置
npm run build
npm run dev
```

**验收标准**:
- [ ] 开发服务器正常启动
- [ ] 构建过程无错误
- [ ] 环境变量正确加载

#### 1.3 核心组件功能验证
**预估时间**: 2天
**负责模块**: `src/features/`

**DocumentManager组件修复**:
```typescript
// src/features/DocumentManager.tsx 需要修改的内容
1. 文档上传功能适配
   - 修改上传API调用格式
   - 适配进度回调机制
   - 处理RAG-Anything特有的响应格式

2. 文档列表显示优化
   - 适配新的文档状态字段
   - 修复分页和排序逻辑
   - 优化实时刷新机制

3. 批量操作功能
   - 验证批量删除功能
   - 修复选择逻辑
   - 优化操作反馈
```

**RetrievalTesting组件修复**:
```typescript
// src/features/RetrievalTesting.tsx 需要修改的内容
1. 查询模式适配
   - 验证所有查询模式 (naive/local/global/hybrid)
   - 适配流式响应格式
   - 修复查询历史存储

2. 结果展示优化
   - 改进Markdown渲染
   - 添加来源引用显示
   - 优化长文本的展示格式
```

**GraphViewer组件验证**:
```typescript
// src/features/GraphViewer.tsx 需要验证的功能
1. 图谱数据加载
   - 验证知识图谱API接口
   - 确保节点和边数据正确解析
   - 优化大型图谱的加载性能

2. 交互功能测试
   - 节点拖拽和缩放
   - 搜索和过滤功能
   - 布局算法选择
```

**验收标准**:
- [ ] 所有核心组件正常渲染
- [ ] 基础功能完全可用
- [ ] 无控制台错误或警告

### Phase 2: 用户体验优化 (🔥高优先级)

#### 2.1 文档管理增强
**预估时间**: 3天
**负责模块**: `src/components/documents/`

**拖拽上传优化**:
```typescript
// src/components/documents/UploadDocumentsDialog.tsx
1. 实现真正的拖拽区域
   - 添加拖拽悬停效果
   - 支持多文件拖拽
   - 文件类型验证和提示（本地部署上传速度快）

2. 解析进度详细显示
   - 显示文档解析阶段进度（解析过程较耗时）
   - 实时解析状态更新（页面数、处理阶段等）
   - WebSocket连接显示解析进度
   - 添加错误状态处理
   - 实现处理队列管理

3. 文件预览功能
   - 支持图片预览
   - PDF文件首页预览
   - 文件信息详细显示
```

**文档列表优化**:
```typescript
// src/features/DocumentManager.tsx
1. 实时解析状态更新
   - WebSocket连接显示文档解析进度（重点功能）
   - 解析阶段详细信息展示
   - 解析进度百分比和剩余时间估算
   - 智能轮询策略作为备选方案
   - 状态变化动画效果

2. 高级筛选功能
   - 按日期范围筛选
   - 按文件类型筛选
   - 按处理状态筛选
   - 搜索功能增强

3. 批量操作优化
   - 批量重新处理
   - 批量导出功能
   - 操作确认对话框
```

**验收标准**:
- [ ] 拖拽上传体验流畅
- [ ] 进度显示准确详细
- [ ] 文档管理功能完整

#### 2.2 查询界面优化
**预估时间**: 3天
**负责模块**: `src/features/RetrievalTesting.tsx`

**查询体验增强**:
```typescript
1. 智能查询建议
   - 基于已处理文档的关键词提示
   - 查询历史自动补全
   - 常用查询模板

2. 结果展示优化
   - 源文档引用链接
   - 相关性评分显示
   - 答案可信度指标
   - 结果导出功能

3. 多模态查询支持
   - 支持图片查询输入
   - 表格数据查询
   - 混合内容查询界面
```

**对话功能增强**:
```typescript
1. 连续对话支持
   - 上下文记忆机制
   - 对话历史管理
   - 话题切换功能

2. 查询模式优化
   - 模式选择引导
   - 参数调优界面
   - 自定义查询配置
```

**验收标准**:
- [ ] 查询体验直观易用
- [ ] 结果展示信息丰富
- [ ] 支持多种查询方式

#### 2.3 知识图谱增强
**预估时间**: 2天
**负责模块**: `src/features/GraphViewer.tsx`

**交互体验优化**:
```typescript
1. 图谱探索功能
   - 节点详情面板
   - 关系路径高亮
   - 局部图谱展开

2. 搜索和导航
   - 实体搜索增强
   - 关系类型筛选
   - 图谱导航历史

3. 可视化优化
   - 自适应布局算法
   - 节点重要性可视化
   - 边权重表示优化
```

**验收标准**:
- [ ] 图谱交互流畅自然
- [ ] 可视化效果清晰
- [ ] 探索功能完整

### Phase 3: 高级功能实现 (🔶中优先级)

#### 3.1 多模态内容支持
**预估时间**: 4天
**负责模块**: 新增多模态组件

**图像内容处理**:
```typescript
// src/components/multimodal/ImageViewer.tsx
1. 图像展示组件
   - 支持多种图像格式
   - 图像缩放和旋转
   - 图像标注功能

2. 图像查询界面
   - 图像上传查询
   - 图像内容描述
   - 相似图像检索
```

**表格数据可视化**:
```typescript
// src/components/multimodal/TableViewer.tsx
1. 表格数据展示
   - 动态表格渲染
   - 数据排序和筛选
   - 表格数据导出

2. 图表生成功能
   - 自动图表推荐
   - 交互式图表
   - 数据统计分析
```

**验收标准**:
- [ ] 多媒体内容正确显示
- [ ] 多模态查询功能可用
- [ ] 内容处理性能良好

#### 3.2 系统监控界面
**预估时间**: 3天
**负责模块**: `src/features/SystemMonitor.tsx`

**性能监控面板**:
```typescript
1. 实时指标展示
   - CPU和内存使用率
   - 查询响应时间
   - 文档处理队列状态

2. 历史数据图表
   - 性能趋势分析
   - 使用量统计
   - 错误率监控

3. 告警和通知
   - 异常状态提醒
   - 性能阈值告警
   - 系统健康报告
```

**验收标准**:
- [ ] 监控数据准确实时
- [ ] 图表展示清晰直观
- [ ] 告警机制有效

#### 3.3 配置管理界面
**预估时间**: 3天
**负责模块**: `src/features/ConfigManager.tsx`

**系统配置界面**:
```typescript
1. 模型参数配置
   - LLM模型选择和参数
   - 嵌入模型配置
   - 解析器参数调整

2. 处理策略配置
   - 多模态处理开关
   - 批处理参数设置
   - 缓存策略配置

3. 配置导入导出
   - 配置文件管理
   - 预设配置模板
   - 配置版本控制
```

**验收标准**:
- [ ] 配置界面友好易用
- [ ] 参数验证完整
- [ ] 配置持久化可靠

### Phase 4: 生产就绪优化 (🔷低优先级)

#### 4.1 性能优化
**预估时间**: 2天

**代码分割和懒加载**:
```typescript
1. 路由级代码分割
   - 按功能模块分割
   - 组件懒加载
   - 预加载策略

2. 资源优化
   - 图片懒加载
   - 大文件分块上传
   - API请求去重
```

#### 4.2 用户体验完善
**预估时间**: 2天

**交互细节优化**:
```typescript
1. 加载状态管理
   - 全局loading状态
   - 骨架屏组件
   - 进度指示器

2. 错误处理优化
   - 友好错误提示
   - 错误恢复机制
   - 操作撤销功能
```

#### 4.3 国际化和主题
**预估时间**: 2天

**多语言支持**:
```typescript
1. 翻译内容补全
   - 界面文本翻译
   - 错误信息翻译
   - 帮助文档翻译

2. 主题系统优化
   - 自定义主题选项
   - 主题配置持久化
   - 高对比度模式
```

## 🛠️ 开发环境设置

### 本地开发环境
```bash
# 1. 安装依赖
cd /home/ragsvr/projects/ragsystem/RAG-Anything/webui
npm install

# 2. 启动开发服务器
npm run dev

# 3. 构建生产版本
npm run build

# 4. 预览生产版本
npm run preview
```

### 开发工具配置
```bash
# 1. 代码格式化
npm run lint
prettier --write src/

# 2. 类型检查
npx tsc --noEmit

# 3. 测试运行
npm test
```

## 📊 质量标准

### 代码质量
- **TypeScript**: 严格模式，无any类型
- **ESLint**: 无错误，警告<10个
- **测试覆盖率**: >80%
- **性能**: Lighthouse分数>90

### 用户体验
- **首次加载**: <3秒
- **交互响应**: <100ms
- **无障碍**: WCAG 2.1 AA级别
- **浏览器兼容**: 支持主流浏览器最新2个版本

### 功能完整性
- **核心功能**: 100%可用
- **边界情况**: 完善处理
- **错误恢复**: 自动重试机制
- **数据一致性**: 状态同步准确

## 🚀 部署配置

### 开发环境部署
```bash
# 1. 环境配置
export VITE_BACKEND_URL=http://localhost:8001
export NODE_ENV=development

# 2. 启动开发服务器
npm run dev
```

### 生产环境部署
```bash
# 1. 构建生产版本
npm run build

# 2. 配置静态文件服务
# Nginx配置文件示例
server {
    listen 80;
    location /webui/ {
        root /path/to/dist;
        try_files $uri $uri/ /index.html;
    }
}
```

## 📝 测试计划

### 单元测试
- **组件测试**: 每个React组件
- **工具函数测试**: utils和lib目录
- **API调用测试**: api目录的接口函数

### 集成测试
- **页面流程测试**: 完整用户操作流程
- **API集成测试**: 前后端接口对接
- **状态管理测试**: Zustand store测试

### 端到端测试
- **关键用户路径**: 文档上传→处理→查询→结果展示
- **错误场景测试**: 网络异常、服务异常等
- **性能测试**: 大文件上传、大量查询等

## 📋 验收清单

### Phase 1验收
- [ ] WebUI能正常启动(npm run dev)
- [ ] 所有API接口调用成功
- [ ] 核心页面无渲染错误
- [ ] 基础功能可以使用

### Phase 2验收
- [ ] 文档上传体验流畅
- [ ] 查询功能完整可用
- [ ] 知识图谱正常显示
- [ ] 错误处理机制完善

### Phase 3验收
- [ ] 多模态内容支持
- [ ] 系统监控功能完整
- [ ] 配置管理界面可用
- [ ] 高级功能稳定可靠

### 最终验收
- [ ] 所有功能正常运行
- [ ] 性能指标达到要求
- [ ] 用户体验流畅友好
- [ ] 代码质量符合标准

---

**文档版本**: v1.0
**最后更新**: 2025-08-17
**负责人**: 前端开发团队